; MeshLED ESP firmware environments

[platformio]
src_dir = .
; Keep all PlatformIO-generated files out of the Arduino sketch folder
; so Arduino IDE file watchers don't choke on .pio build churn.
workspace_dir = ${sysenv.HOME}/Library/Caches/platformio-meshled-workspace

[env:esp32dev]
platform = espressif32@~5.4.0
board = esp32dev
framework = arduino
monitor_speed = 115200
extra_scripts = pre:extra_script.py
board_build.filesystem = spiffs
build_src_filter =
    +<*>
    -<vendor/ofxColorTheory/example/>
    -<vendor/ofxColorTheory/src/>
build_unflags =
    -std=gnu++11

; Default partition scheme with 1.9MB application, 190KB SPIFFS
board_build.partitions = default.csv
build_flags =
    -std=gnu++17
    -I../../packages/lightgraph/include
    -DDEV_ENABLED

lib_deps =
    ; ESP32 WiFi

    ; NeoPixelBus library for addressable LEDs
    makuna/NeoPixelBus @ ^2.7.6
    
    ; FastLED library for LED support
    fastled/FastLED @ ^3.6.0
    
    hideakitai/ArduinoOSC@^0.5.2
    
    ; ESP32 system libraries

    ; JSON serialization/parsing for settings and API payloads
    bblanchon/ArduinoJson @ ^6.21.5

    ; ICMP ping support used by ESP-NOW peer discovery
    dvarrel/ESPping @ ^1.0.5

; Alternative environment for ESP32-S3 if needed
[env:esp32-s3-devkitc-1]
platform = espressif32@~5.4.0
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200
extra_scripts = pre:extra_script.py
board_build.filesystem = spiffs
board_build.partitions = default_8MB.csv
build_src_filter =
    +<*>
    -<vendor/ofxColorTheory/example/>
    -<vendor/ofxColorTheory/src/>
build_unflags =
    -std=gnu++11
build_flags =
    -std=gnu++17
    -I../../packages/lightgraph/include
    -DDEV_ENABLED
lib_deps =
    ; ESP32 WiFi

    ; NeoPixelBus library for addressable LEDs
    makuna/NeoPixelBus @ ^2.7.6
    
    ; FastLED library for LED support
    fastled/FastLED @ ^3.6.0

    hideakitai/ArduinoOSC@^0.5.2
    
    ; ESP32 system libraries 

    ; JSON serialization/parsing for settings and API payloads
    bblanchon/ArduinoJson @ ^6.21.5

    ; ICMP ping support used by ESP-NOW peer discovery
    dvarrel/ESPping @ ^1.0.5

; Release environment for ESP32 with developer-only routes disabled
[env:esp32dev-release]
platform = espressif32@~5.4.0
board = esp32dev
framework = arduino
monitor_speed = 115200
extra_scripts = pre:extra_script.py
board_build.filesystem = spiffs
build_src_filter =
    +<*>
    -<vendor/ofxColorTheory/example/>
    -<vendor/ofxColorTheory/src/>
build_unflags =
    -std=gnu++11
board_build.partitions = default.csv
build_flags =
    -std=gnu++17
    -I../../packages/lightgraph/include
lib_deps =
    makuna/NeoPixelBus @ ^2.7.6
    fastled/FastLED @ ^3.6.0
    hideakitai/ArduinoOSC@^0.5.2
    bblanchon/ArduinoJson @ ^6.21.5
    dvarrel/ESPping @ ^1.0.5

; Release environment for ESP32-S3 with developer-only routes disabled
[env:esp32-s3-devkitc-1-release]
platform = espressif32@~5.4.0
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200
extra_scripts = pre:extra_script.py
board_build.filesystem = spiffs
board_build.partitions = default_8MB.csv
build_src_filter =
    +<*>
    -<vendor/ofxColorTheory/example/>
    -<vendor/ofxColorTheory/src/>
build_unflags =
    -std=gnu++11
build_flags =
    -std=gnu++17
    -I../../packages/lightgraph/include
lib_deps =
    makuna/NeoPixelBus @ ^2.7.6
    fastled/FastLED @ ^3.6.0
    hideakitai/ArduinoOSC@^0.5.2
    bblanchon/ArduinoJson @ ^6.21.5
    dvarrel/ESPping @ ^1.0.5

; Usage instructions:
; - For ESP32: pio run -e esp32dev -t upload
; - For ESP32-S3: pio run -e esp32-s3-devkitc-1 -t upload
; - For release ESP32: pio run -e esp32dev-release -t upload
; - For release ESP32-S3: pio run -e esp32-s3-devkitc-1-release -t upload
; - Upload filesystem: pio run -e [env] -t uploadfs
